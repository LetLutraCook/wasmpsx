<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>WASMpsx Emulator</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <script src="coi-serviceworker.min.js"></script>

    <script>
        window.WASMpsxOptions = {
            wasmUrl: "wasmpsx_worker.wasm",
            workerUrl: "wasmpsx_worker.js"
        };
    </script>

    <script type="module" src="wasmpsx.min.js"></script>
</head>
<body style="background:#111; color:#0f0; font-family:monospace; padding:20px;">

    <h3>WASMpsx Status</h3>
    
    <wasmpsx-player id="player"></wasmpsx-player>

    <div style="margin: 20px 0;">
        <input type="file" id="romfile">
    </div>

    <pre id="log" style="background:#000; border:1px solid #333; padding:15px; height:250px; overflow-y:scroll; font-size:12px;"></pre>

    <script>
        const logger = document.getElementById("log");
        function log(msg) {
            logger.textContent += msg + "\n";
            logger.scrollTop = logger.scrollHeight;
        }

        async function init() {
            log("--- System Check ---");
            log(`SharedArrayBuffer: ${typeof SharedArrayBuffer !== 'undefined' ? '✅' : '❌'}`);
            
            // Check for the files shown in your screenshot
            const files = ["wasmpsx_worker.wasm", "wasmpsx_worker.js", "wasmpsx_ww.wasm"];
            for (const f of files) {
                try {
                    const r = await fetch(f, { method: 'HEAD' });
                    log(`${f}: ${r.ok ? '✅ Found' : '❌ Missing'}`);
                } catch(e) { log(`${f}: ❌ Error`); }
            }

            log("Waiting for element to wake up...");
            
            let attempts = 0;
            const check = setInterval(() => {
                attempts++;
                const el = customElements.get("wasmpsx-player");
                if (el) {
                    clearInterval(check);
                    log("✅ SUCCESS: <wasmpsx-player> is active!");
                } else if (attempts > 10) {
                    clearInterval(check);
                    log("❌ FAIL: Registration timed out.");
                }
            }, 1000);
        }

        document.getElementById("romfile").onchange = (e) => {
            const p = document.getElementById("player");
            if (p && p.readFile) {
                log("Loading ROM...");
                p.readFile(e.target.files[0]);
            } else {
                log("❌ Error: Element not initialized.");
            }
        };

        init();
    </script>
</body>
</html>
