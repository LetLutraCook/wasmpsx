
  <!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>WASMpsx</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Load WASMpsx -->
  <script src="wasmpsx.min.js"></script>
</head>
<body>

<h1>WASMpsx Test</h1>

<!-- Emulator display -->
<wasmpsx-player id="player"></wasmpsx-player>

<!-- File picker -->
<input id="romfile" type="file" />

<!-- Log output -->
<pre id="log" style="background:#000; color:#0f0; padding:10px; white-space:pre-wrap;"></pre>

<script>
  const player = document.getElementById("player");
  const fileInput = document.getElementById("romfile");
  const logBox = document.getElementById("log");

  function log(msg) {
    logBox.textContent += msg + "\n";
  }

  log("WASMpsx initialized.");
  log("Waiting for ROM...");

  // Handle file selection
  fileInput.addEventListener("change", () => {
    const file = fileInput.files[0];
    if (!file) {
      log("No file selected.");
      return;
    }

    log("Selected file: " + file.name);
    log("Size: " + Math.round(file.size / 1024 / 1024) + " MB");
    log("Loading ROM...");

    try {
      player.readFile(file);
      log("readFile() called.");
    } catch (err) {
      log("ERROR calling readFile(): " + err);
    }
  });

  // Catch global errors
  window.addEventListener("error", (e) => {
    log("WINDOW ERROR: " + e.message);
  });

  window.addEventListener("unhandledrejection", (e) => {
    log("PROMISE ERROR: " + e.reason);
  });

  // Style canvas after it appears
  setTimeout(() => {
    try {
      const canvas = player.shadowRoot.querySelector("canvas");
      canvas.style = "background:black; display:block; margin:auto;";
      log("Canvas ready.");
    } catch (err) {
      log("Canvas error: " + err);
    }
  }, 200);
</script>

</body>
</html>
